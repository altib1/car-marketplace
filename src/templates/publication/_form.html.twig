<!-- templates/publication/_form.html.twig -->

{{ form_start(form) }}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <div class="mb-4">
            {{ form_label(form.price, 'Price', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.price, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.price) }}
        </div>
    </div>

    <div class="mb-4">
        {{ form_label(form.description, 'Description', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
        {{ form_widget(form.description, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md h-32'}}) }}
        {{ form_errors(form.description) }}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="mb-4">
            {{ form_label(form.brand, 'Brand', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.brand, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.brand) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.model, 'Model', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.model, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.model) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.motorizationType, 'Motorisation Type', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.motorizationType, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.motorizationType) }}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="mb-4">
            {{ form_label(form.year, 'Year', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.year, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.year) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.mileage, 'Mileage', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.mileage, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.mileage) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.engineSize, 'Engine Size (Chevaux)', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.engineSize, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.engineSize) }}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="mb-4">
            {{ form_label(form.fuelType, 'Fuel Type', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.fuelType, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.fuelType) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.gearbox, 'Gearbox', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.gearbox, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.gearbox) }}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="mb-4">
            {{ form_label(form.condition, 'Vehicle Condition', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.condition, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.condition) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.country, 'Country', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.country, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.country) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.sellerLocation, 'Location', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.sellerLocation, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.sellerLocation) }}
        </div>
    </div>

    <div class="bg-gray-50 p-4 rounded-lg mb-4">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Warranty Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="mb-4">
                {{ form_label(form.hasWarranty, 'Has Warranty', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
                {{ form_widget(form.hasWarranty, {'attr': {'class': 'mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded'}}) }}
                {{ form_errors(form.hasWarranty) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.warrantyMonths, 'Warranty Duration (months)', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
                {{ form_widget(form.warrantyMonths, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
                {{ form_errors(form.warrantyMonths) }}
            </div>
        </div>
    </div>

    <div class="bg-gray-50 p-4 rounded-lg mb-4">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Equipment & Features</h3>
        <div class="mb-4" id="equipment-collection"
             data-prototype="{{ form_widget(form.equipment.vars.prototype)|e('html_attr') }}">
            {% for equipmentField in form.equipment %}
                <div class="equipment-item mb-2">
                    {{ form_widget(equipmentField, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
                </div>
            {% endfor %}
        </div>
        <button type="button" class="add-equipment-item bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded-md text-sm">
            Add Equipment Item
        </button>
    </div>

    <div class="bg-gray-50 p-4 rounded-lg mb-4">
        <div class="mb-6">
            {{ form_label(form.images, 'Vehicle Images', {'label_attr': {'class': 'block text-xl font-semibold text-gray-800 mb-3'}}) }}
            <div class="mt-2 flex flex-col items-center p-8 border-3 border-blue-100 border-dashed rounded-xl hover:border-blue-300 transition-all duration-300 bg-gradient-to-b from-blue-50 to-white shadow-sm">
            <div class="animate-bounce-slow">
                <svg class="h-16 w-16 text-blue-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <label for="{{ form.images.vars.id }}" class="cursor-pointer group mt-4">
                <span class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full text-sm font-medium inline-flex items-center transform transition-all duration-200 hover:scale-105 hover:shadow-lg">
                <span class="mr-2">ðŸ“¸</span> Upload Photos
                </span>
                {{ form_widget(form.images, {'attr': {'class': 'hidden', 'onchange': 'handleImageSelection(event)', 'multiple': 'multiple', 'accept': 'image/*'}}) }}
            </label>
            <p class="text-sm text-gray-500 mt-3">Drag and drop your images or click to browse</p>
            <p class="text-xs text-gray-400 mt-1">Maximum 5MB per image</p>
            </div>
            <div id="image-preview" class="mt-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
            {{ form_errors(form.images) }}
        </div>

        <div class="mb-4 hidden">
            {{ form_label(form.video, 'Video', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.video, {'attr': {'class': 'mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md'}}) }}
            {{ form_errors(form.video) }}
        </div>
    </div>

    <div class="flex justify-end">
        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md shadow-md transition-all">
            {{ button_label|default('Save') }}
        </button>
    </div>
{{ form_end(form) }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Equipment collection handling
    const addEquipmentButton = document.querySelector('.add-equipment-item');
    const equipmentCollection = document.querySelector('#equipment-collection');
    let equipmentIndex = document.querySelectorAll('.equipment-item').length;

    addEquipmentButton.addEventListener('click', function() {
        const prototype = equipmentCollection.dataset.prototype;
        const newForm = prototype.replace(/__name__/g, equipmentIndex);
        const div = document.createElement('div');
        div.className = 'equipment-item mb-2 flex gap-2';
        div.innerHTML = newForm;
        
        // Add remove button
        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-md text-sm';
        removeButton.textContent = 'Remove';
        removeButton.onclick = function() {
            div.remove();
        };
        
        div.appendChild(removeButton);
        equipmentCollection.appendChild(div);
        equipmentIndex++;
    });
});

function handleImageSelection(event) {
    const preview = document.getElementById('image-preview');
    preview.innerHTML = '';
    Array.from(event.target.files).forEach((file, index) => {
    if (file.size > 5 * 1024 * 1024) {
        alert(`${file.name} exceeds the 5MB limit`);
        return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        preview.innerHTML += `
        <div class="relative group aspect-square transform transition-all duration-200 hover:scale-105">
            <img src="${e.target.result}" class="w-full h-full object-cover rounded-xl shadow-md" />
            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded-xl"></div>
            <button onclick="removeImage(${index})" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200 transform hover:scale-110">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            </button>
        </div>
        `;
    };
    reader.readAsDataURL(file);
    });
}
function removeImage(index) {
    const input = document.querySelector('#{{ form.images.vars.id }}');
    const dt = new DataTransfer();
    Array.from(input.files).forEach((file, i) => {
    if (i !== index) dt.items.add(file);
    });
    input.files = dt.files;
    handleImageSelection({target: input});
}
</script>